# ä»¥å›¾æœå›¾

<p align="center">
â€¢ ğŸ¤– <a href="https://modelscope.cn/models/iic/cv_resnest101_general_recognition/summary" target="_blank">ModelScope</a> â€¢ ğŸ“ƒ <a href="https://milvus.io/" target="_blank">Milvus</a>  
</p>

![alt text](example_image/æ£®æ—.jpg)

## æ›´æ–°
### 2024/8/9
- å…ˆæŠ å›¾å†è¯†åˆ«

### 2024/8/8
- æ·»åŠ é€‰æ‹©æ•°æ®åº“é›†åˆé€‰é¡¹
- æ·»åŠ å¯é€‰æ‹©è¿”å›å›¾ç‰‡æ•°é‡
- æ·»åŠ å¯é€‰æ‹©L2ç›¸ä¼¼åº¦é˜ˆå€¼
- æ·»åŠ configæ–‡ä»¶ä¸€é”®é…ç½®å„ä¸ªå‚æ•°ä¿¡æ¯
- æ·»åŠ requirements.txtæ–‡ä»¶ä¸€é”®é…ç½®ç¯å¢ƒ
- æ·»åŠ ç»“æœtopæ–‡æœ¬æè¿°ä¿¡æ¯
- ä¸€é”®åˆ é™¤å›¾ç‰‡åº“

### å³å°†æ›´æ–°
- é›†åˆåˆ†åŒº
- è‡ªåŠ¨ä¸Šä¼ dataç›®å½•ä¸­æ–°æ·»åŠ çš„å›¾ç‰‡


## ä»‹ç»

æœ¬æ–‡æ¡£æ—¨åœ¨ä»‹ç»å¦‚ä½•ä½¿ç”¨ ModelScope ä¸­çš„é€šç”¨é¢†åŸŸæ¨¡å‹ï¼ˆcv_resnest101_general_recognitionï¼‰ä¸å•†å“æ˜¾è‘—æ€§å›¾åƒåˆ†å‰²-ç”µå•†é¢†åŸŸæ¨¡å‹ï¼ˆcv_vitb16_segmentation_shop-segï¼‰ä»¥åŠæ­é… Milvus å‘é‡æ•°æ®åº“å®ç°ä»¥å›¾æœå›¾çš„åŠŸèƒ½ã€‚è¿™é¡¹æŠ€æœ¯èƒ½å¤Ÿæœ‰æ•ˆåœ°ä»å¤§é‡å›¾ç‰‡ä¸­è¿…é€Ÿè¯†åˆ«å‡ºä¸ç›®æ ‡å›¾ç‰‡ç›¸ä¼¼çš„å›¾ç‰‡ï¼Œä¸ºå›¾åƒæ£€ç´¢ä»»åŠ¡æä¾›äº†ä¸€ç§é«˜æ•ˆçš„è§£å†³æ–¹æ¡ˆ

### Milvus

- **æ•°æ®åº“ç±»å‹ï¼š** Milvus å‘é‡æ•°æ®åº“
- **æ•°æ®åº“ç‰¹ç‚¹ï¼š** Milvus æ˜¯ä¸€ä¸ªå¼€æºçš„å‘é‡ç›¸ä¼¼æ€§æ£€ç´¢å¼•æ“ï¼Œä¸“æ³¨äºé«˜æ€§èƒ½çš„å‘é‡ç›¸ä¼¼æ€§æœç´¢ã€‚å®ƒæ”¯æŒå¤šç§ç›¸ä¼¼æ€§æœç´¢ç®—æ³•ï¼Œå¹¶æä¾›äº†å¯æ‰©å±•çš„æ¶æ„ï¼Œé€‚ç”¨äºå¤§è§„æ¨¡çš„å‘é‡æ•°æ®å­˜å‚¨å’Œæ£€ç´¢ã€‚
- **æ•°æ®åº“æè¿°ï¼š** Milvus å‘é‡æ•°æ®åº“èƒ½å¤Ÿå¸®åŠ©ç”¨æˆ·è½»æ¾åº”å¯¹æµ·é‡éç»“æ„åŒ–æ•°æ®ï¼ˆå›¾ç‰‡/è§†é¢‘/è¯­éŸ³/æ–‡æœ¬ï¼‰æ£€ç´¢ã€‚å•èŠ‚ç‚¹ Milvus å¯ä»¥åœ¨ç§’å†…å®Œæˆåäº¿çº§çš„å‘é‡æœç´¢ï¼Œåˆ†å¸ƒå¼æ¶æ„äº¦èƒ½æ»¡è¶³ç”¨æˆ·çš„æ°´å¹³æ‰©å±•éœ€æ±‚ã€‚

### cv_resnest101_general_recognition

- **æ¨¡å‹åç§°ï¼š** cv_resnest101_general_recognition
- **æ¨¡å‹ç±»å‹ï¼š** è§†è§‰åˆ†ç±»
- **æ¨¡å‹æè¿°ï¼š** è¯¥æ¨¡å‹åŸºäº ResNeSt101 æ¶æ„ï¼Œç»è¿‡å¤§è§„æ¨¡æ•°æ®é›†çš„é¢„è®­ç»ƒå’Œç²¾è°ƒï¼Œå…·æœ‰è¾ƒå¼ºçš„å›¾åƒè¯†åˆ«èƒ½åŠ›ã€‚å®ƒèƒ½å¤Ÿè¯†åˆ«é€šç”¨é¢†åŸŸä¸­çš„å„ç§ç‰©ä½“ã€åœºæ™¯å’Œå›¾æ¡ˆ

### cv_vitb16_segmentation_shop-seg

- **æ¨¡å‹åç§°ï¼š** cv_vitb16_segmentation_shop-seg
- **æ¨¡å‹ç±»å‹ï¼š** è§†è§‰åˆ†å‰²
- **æ¨¡å‹æè¿°ï¼š** æ¨¡å‹ç»“æ„ä¸ºDenseclipç»“æ„ï¼Œè§†è§‰encoderé‡‡ç”¨vit-base-patch16ç»“æ„ï¼Œç»è¿‡40wå•†å“æ˜¾è‘—æ€§åˆ†å‰²æ•°æ®çš„é¢„è®­ç»ƒå’Œç²¾è°ƒï¼Œå…·æœ‰è¾ƒå¼ºçš„å›¾åƒåˆ†å‰²èƒ½åŠ›ã€‚å®ƒèƒ½å¤Ÿè¯†åˆ«å•†å“åœºæ™¯ï¼Œå¯¹é€šç”¨åœºæ™¯æ•ˆæœè¾ƒå·®ï¼Œç‰¹æ®Šé¢†åŸŸç‰©å“å»ºè®®ä¸è¦ä½¿ç”¨

## ä»£ç ä½¿ç”¨æµç¨‹
```
# æ‹‰å–ä»“åº“
$ git clone https://github.com/AnitaSherry/search_by_Image.git

# è¿›å…¥ç›®å½•
$ cd search_by_Image
```
### æ¨¡å‹éƒ¨ç½²ç¯å¢ƒ
ä¸‹è½½anaconda3å¹¶å®‰è£…
æ·»åŠ é•œåƒæº
```
conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main
conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free
conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/conda-forge
```
é‡æ–°ç™»é™†ä¸€ä¸‹æœåŠ¡å™¨ï¼Œåˆå§‹åŒ–condaï¼Œå¹¶åˆ›å»ºç¯å¢ƒ
```
conda init
conda create -n sakura python=3.10
```
å®‰è£…ç¯å¢ƒæ‰€éœ€åŒ…ï¼ˆNVIDIAæ˜¾å¡é©±åŠ¨[å®‰è£…å‚è€ƒ](https://blog.csdn.net/weixin_46398647/article/details/137666448?spm=1001.2014.3001.5502)ï¼‰
```
pip install -r requirements.txt
```
å…¶ä¸­mmcvåŒ…åœ¨[è¿™é‡Œ](https://download.openmmlab.com/mmcv/dist/cu121/torch2.3.0/index.html)ä¸‹è½½
1. **ä¸‹è½½æ¨¡å‹ï¼š** 

   ```
   python model/modescope_model_init.py
   ```

   è®°å½•å¥½æ¨¡å‹ä¸‹è½½åçš„è·¯å¾„ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æ¨¡å‹è·¯å¾„ä¸ºï¼š

   ```
   Linux_ModelFile="/root/.cache/modelscope/hub/damo/cv_resnest101_general_recognition/pytorch_model.pt"
   Windows_ModelFile='C:\\Users\\Administrator\\.cache\\modelscope\\hub\\damo\\cv_resnest101_general_recognition\\pytorch_model.pt'
   ```
   å°†å¾—åˆ°çš„è·¯å¾„è®°å½•ä¸‹æ¥ï¼Œæ›¿æ¢config.pyä»£ç ä¸­EMBçš„è·¯å¾„

2. **å›¾åƒè½¬å‘é‡å¹¶å­˜å…¥å‘é‡åº“ï¼š** 

   ```
   python Image_vectorization.py --data data
   ```
   å¦‚æœä½¿ç”¨å›¾åƒåˆ†å‰²ï¼Œæ·»åŠ ï¼š--use_seg

   dataç›®å½•ä¸­ç›´æ¥å­˜æ”¾å›¾ç‰‡ï¼ˆdataç›®å½•ä¸­å¯å…¨éƒ¨éƒ½æ˜¯å›¾ç‰‡æˆ–åˆ†ä¸ºå‡ ä¸ªå­æ–‡ä»¶å¤¹ä¸­å­˜æ”¾å›¾ç‰‡ï¼Œå­æ–‡ä»¶å¤¹å³ä¸ºmilvusæ•°æ®åº“ä¸­çš„é›†åˆï¼‰

   **æ³¨**ï¼šå¦‚æœè¦åˆ é™¤è¿™ä¸ªå‘é‡æ•°æ®åº“æ‰§è¡Œ
   ```
   python milvus_manage/milvus_reduction.py
   ```

3. **å‰ç«¯æœç´¢åŠŸèƒ½ä½¿ç”¨æ¼”ç¤ºï¼š** 

   ```
   python webui.py --server_port 9090
   ```
   å¦‚æœä½¿ç”¨å›¾åƒåˆ†å‰²ï¼Œæ·»åŠ ï¼š--use_seg
   è¿è¡Œåè®¿é—® Running on local URL:  http://127.0.0.1:9090 å³å¯ä½¿ç”¨

## ç»“æœå±•ç¤º
   å±•ç¤ºçš„æ—¶å€™å¦‚æœä½ è§‰å¾—é€Ÿåº¦æ…¢ï¼Œé‚£æ˜¯å› ä¸ºç½‘é€Ÿé™åˆ¶äº†å›¾ç‰‡ä»æœåŠ¡å™¨ä¼ è¾“åˆ°å‰ç«¯

   --use_seg æ·»åŠ åç›¸ä¼¼åº¦å€¼ä¼šéå¸¸å¤§ï¼Œå¾ˆéš¾æœç´¢åˆ°ç›¸ä¼¼å›¾ç‰‡ï¼Œè¿™å¾ˆæ­£å¸¸

![alt text](example_image/image_gradio.png)

å›¾åƒåˆ†å‰²å¤„ç†æµç¨‹

![alt text](example_image/å¼‚å½¢ç¯å…·_æ‹¼æ¥å±•ç¤º.jpg)

<center>
æœ€ç»ˆç”¨äºè¿›è¡Œç›¸ä¼¼åº¦æ¯”å¯¹çš„å›¾åƒ
</center>

<center>
    <img src="example_image/å¼‚å½¢ç¯å…·_ç°è‰²èƒŒæ™¯å‡çº§.jpg" alt="alt text" />
</center>

## Milvuséƒ¨ç½²åŠä½¿ç”¨

```
mkdir Milvus
cd Milvus
wget https://github.com/milvus-io/milvus/releases/download/v2.4.1/milvus-standalone-docker-compose.yml -O docker-compose.yml
sudo docker-compose up -d
sudo docker-compose ps
```

é€šè¿‡å‘½ä»¤æŸ¥çœ‹æ˜¾ç¤ºä¿¡æ¯å¦‚ä¸‹

```
      Name                     Command                  State                            Ports
--------------------------------------------------------------------------------------------------------------------
milvus-etcd         etcd -advertise-client-url ...   Up (healthy)   2379/tcp, 2380/tcp
milvus-minio        /usr/bin/docker-entrypoint ...   Up (healthy)   0.0.0.0:9000->9000/tcp, 0.0.0.0:9001->9001/tcp
milvus-standalone   /tini -- milvus run standalone   Up (healthy)   0.0.0.0:19530->19530/tcp, 0.0.0.0:9091->9091/tcp
```

éªŒè¯è¿æ¥

```
docker port milvus-standalone 19530/tcp
```

åœæ­¢Milvus

```
sudo docker-compose down
```

åœæ­¢ååˆ é™¤æ•°æ®

```
sudo rm -rf  volumes
```

### dockerå®‰è£…

```
sudo yum install docker
sudo systemctl start docker
sudo systemctl enable docker
sudo docker --version
```

è¾“å‡ºç¤ºä¾‹
```
Docker version 18.09.0, build 172f8da
```
### docker-composeå®‰è£…

```
curl -L "https://github.com/docker/compose/releases/download/1.29.2/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
chmod +x /usr/local/bin/docker-compose
docker-compose -v
```

è¾“å‡ºç¤ºä¾‹

```
docker-compose version 1.29.2, build unknown
```

### Milvuså¯è§†åŒ–å·¥å…·Attu

```
docker run -p 8000:3000  -e MILVUS_URL=0.0.0.0:19530 zilliz/attu:dev
```
https://github.com/zilliztech/attu/issues/415
devç‰ˆæœ¬å¯ä»¥æ”¯æŒarrchæ˜‡è…¾æœåŠ¡å™¨ï¼Œæœ¬äººå’ŒAttuå®˜æ–¹äººå‘˜æ²Ÿé€šåå¾—åˆ°ç‰ˆæœ¬ï¼Œx86ç³»ç»Ÿå¯ä»¥ä½¿ç”¨v2.3.8ç‰ˆæœ¬

#### è¿›å…¥ç½‘é¡µç«¯

å¯åŠ¨dockeråï¼Œåœ¨æµè§ˆå™¨ä¸­è®¿é—®â€œhttp://{your machine IP}:8000â€ï¼Œç‚¹å‡»â€œConnectâ€è¿›å…¥AttuæœåŠ¡

Milvus Address å¡«å†™{your machine IP}:19530

Milvus Database (optional) å¦‚æœåˆ›å»ºè¿‡æ•°æ®åº“ç›´æ¥å¡«å†™æ•°æ®åº“åç§°ï¼Œå¦‚æœæ²¡æœ‰å¡«å†™defaultï¼Œåˆ›å»ºä¸€ä¸ªåä¸ºdefaultçš„æ•°æ®åº“

Milvus Username (optional) å’Œ Milvus Password (optional) æ— éœ€å¡«å†™ï¼Œå› ä¸ºé»˜è®¤æ˜¯å…³é—­é‰´æƒçš„

## Dataæ•°æ®ç¤ºä¾‹

```
é“¾æ¥ï¼šhttps://pan.baidu.com/s/1eEDYq0oCBxmVRrIhophgCQ?pwd=c50e 
æå–ç ï¼šc50e
```

## é¼“åŠ±æ”¯æŒ
 ç‚¹ä¸ªèµå†èµ°å‘—ï¼æ¯”å¿ƒğŸ’ï¸

## Star History
[![Star History Chart](https://api.star-history.com/svg?repos=AnitaSherry/search_by_Image&type=Date)](https://star-history.com/#AnitaSherry/search_by_Image&Date)
